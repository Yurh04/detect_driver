# 驾驶员行为实时检测系统技术报告
>软件学院   
>于润昊  
>22379107
## 1. 摘要

本项目开发了一套基于 **YOLOv8** 深度学习框架的驾驶员行为实时检测系统。系统针对驾驶过程中的三种高风险行为——**抽烟 (Smoke)**、**手机使用 (Phone)** 和 **饮水 (Drink)** 进行了专项优化。通过整合微调后的 YOLOv8n/s 模型、自研的“两阶段裁剪检测”算法以及现代化的 FastAPI 后端架构，系统实现了在复杂环境下的高精度、低延迟检测。实验结果显示，优化后的模型在 mAP@0.5 指标上表现优异，能够满足实时监控的安全需求。

---

## 2. 背景与目标

### 2.1 项目背景
分心驾驶是引发交通事故的主要原因之一。自动识别驾驶员的危险行为，不仅可以为保险公司和运输企业提供监控数据，更能实时预警，挽救生命。

### 2.2 技术目标
1. **轻量化部署**: 采用 YOLOv8n/s 模型，确保在普通 PC 或边缘设备上流畅运行。
2. **高召回率**: 特别是针对手机、香烟等小尺寸目标的检测稳定性。
3. **系统集成**: 构建从前端采集到后端处理、结果反馈的完整闭环。

---

## 3. YOLOv8n 模型微调与优化

### 3.1 基础模型选择
我们选择了 **YOLOv8n** 作为基础网络，因其仅有约 3.2M 参数，推理速度极快。同时提供了 **YOLOv8s** 升级脚本，用于在硬件允许的情况下进一步提升精度。

### 3.2 训练策略
- **数据增强**:
    - **Mosaic 4x**: 拼接图像以增强对多尺度目标的识别。
    - **MixUp & Copy-Paste**: 增加背景复杂度和目标多样性。
    - **HSV 变换**: 应对驾驶室内多变的光照条件。
- **超参数优化**:
    - 使用 **AdamW** 优化器替代传统的 SGD，加速收敛并提高泛化能力。
    - 引入 **Cosine 退火学习率** 策略，确保模型在训练后期稳步收敛。
    - 设置 **EMA (指数移动平均)** 以获得更稳定的权重更新。

### 3.3 核心创新：两阶段检测优化 (Two-stage Optimization)
在实际测试中发现，手机和香烟等目标在全景图像中占比极小。为此，我们在推理引擎 `detection.py` 中实现了一套创新的策略：
1. **全局检测**: 首先识别驾驶员（person）。
2. **区域裁剪**: 若识别到驾驶员，则根据其坐标自动裁剪出包含人手和面部的核心区域。
3. **二次推理**: 对裁剪区域使用更低的置信度阈值进行专项重检测。
> [!TIP]  
> 这一策略极大地提升了系统对遮挡、微小动作的敏感度，显著降低了手机和饮水行为的漏报率。

---

## 4. 系统架构与实现

### 4.1 技术栈
- **后端**: FastAPI (Python 3.9+)
- **深度学习引擎**: Ultralytics YOLOv8
- **图像处理**: OpenCV, NumPy
- **前端**: HTML5, Vanilla JavaScript, Canvas API

### 4.2 系统模块设计
系统通过分层架构实现了前后端解耦：
- **检测层 (`detection.py`)**: 封装了 `DetectionEngine` 类，负责模型加载、图像预处理、两阶段检测逻辑以及标注绘制。
- **服务层 (`app.py`)**: 基于 FastAPI 提供 Web 接口，支持多线程处理 `.mp4` 视频流和 Base64 编码的摄像头单帧图。
- **展示层**: 前端使用 Canvas 实时渲染检测框，并动态生成行为统计报告（饼图及时间戳记录）。

---

## 5. 实验分析

### 5.1 检测精度 (Metrics)
根据训练过程中的验证集表现：
- **mAP@0.5**: 达到了 **0.94152**。
- **mAP@0.5:0.95**: 达到了 **0.65009**。
- **召回率 (Recall)**: 针对手机行为的提升尤为显著，得益于局部二次检测策略。

### 5.2 推理性能
在常规 CPU 环境下，单帧检测延迟约为 **30-50ms**；在开启 GPU 加速时，帧率可轻松突破 **60 FPS**。

---

## 6. 结论

本系统成功实现了一套完整的驾驶员行为检测方案。通过在 YOLOv8 轻量级模型基础上引入局部检测优化，解决了小目标检测难的痛点。系统架构清晰，扩展性强，不仅适用于课堂作业演示，更具备向工业级应用迁移的潜力。

---
**项目组成员**: 模式识别大作业团队
**日期**: 2025年12月28日
